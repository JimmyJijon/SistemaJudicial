@model IEnumerable<SistemaGestionJudicial.Models.Persona>

    @{
        ViewData["Title"] = "Index";
    }

    @section Styles {
        <link rel="stylesheet" href="~/css/personas.css" />
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    }

    <div class="flex h-screen overflow-hidden">
        <div class="flex-1 overflow-auto">
            <header class="bg-white shadow-sm py-4 px-6 flex justify-between items-center no-print">
                <h2 class="text-xl font-semibold text-gray-800">Gestión de Personas</h2>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <input type="text" placeholder="Buscar..."
                               class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="text-sm font-medium">Admin</span>
                    </div>
                </div>
            </header>

            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Listado de Personas</h2>
                    <button onclick="openModal('add-persona-modal')"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                        <i class="fas fa-plus mr-2"></i>Agregar Nueva Persona
                    </button>
                </div>

                <div class="card bg-white rounded-lg p-6">
                    <div class="overflow-x-auto">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Cédula</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Nombres</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Apellidos</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Fecha Nacimiento</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Rol Persona</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Género</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Dirección</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Teléfono</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Correo</th>
                                    <th class="px-4 py-2 text-center text-sm font-semibold text-gray-700">Acciones</th>
                                </tr>
                            </thead>
                            @if (Model != null && Model.Any())
                            {
                                <tbody class="bg-white divide-y divide-gray-200">
                                    @foreach (var p in Model)
                                    {
                                        <tr>
                                            <td class="px-4 py-2">@p.Cedula</td>
                                            <td class="px-4 py-2">@p.Nombres</td>
                                            <td class="px-4 py-2">@p.Apellidos</td>
                                            <td class="px-4 py-2">@p.FechaNacimiento</td>
                                            <td class="px-4 py-2">@p.IdRolNavigation?.Nombre</td>
                                            <td class="px-4 py-2">@p.Genero</td>
                                            <td class="px-4 py-2">@p.Direccion</td>
                                            <td class="px-4 py-2">@p.Telefono</td>
                                            <td class="px-4 py-2">@p.CorreoElectronico</td>
                                            <td class="px-4 py-2 text-center">
                                                <!-- Ver Detalle -->
                                                <button class="text-blue-600 hover:text-blue-800 mr-2"
                                                        onclick="verDetallePersona('@p.IdPersona','@p.Cedula','@p.Nombres',
                                                        '@p.Apellidos','@(p.FechaNacimiento?.ToString("yyyy-MM-dd"))',
                                                        '@p.Genero','@p.Direccion','@p.Telefono','@p.CorreoElectronico',
                                                        '@p.IdRolNavigation?.Nombre')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <!-- Editar -->
                                                <button class="text-green-600 hover:text-green-800 mr-2"
                                                        onclick="openEditModal('@p.IdPersona','@p.Cedula','@p.Nombres',
                                                        '@p.Apellidos','@(p.FechaNacimiento?.ToString("yyyy-MM-dd"))',
                                                        '@p.Genero','@p.Direccion','@p.Telefono','@p.CorreoElectronico',
                                                        '@p.IdRol')">
                                                    <i class="fas fa-edit"></i>
                                                </button>

                                                <!-- Eliminar -->
                                                @* <button class="text-red-600 hover:text-red-800"
                                                    onclick="confirmDelete('@p.IdPersona','@p.Nombres','@p.Apellidos')">
                                                <i class="fas fa-trash"></i>
                                            </button> *@
                                            </td>

                                        </tr>
                                    }
                                </tbody>
                            }
                            else
                            {

                            }

                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar persona -->
    <div id="add-persona-modal" class="modal hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50">
        <div class="modal-content bg-white rounded-lg p-6 w-full max-w-3xl">
            <h3 class="text-lg text-center text-blue-600 font-bold mb-4">Agregar Nueva Persona</h3>
            @using (Html.BeginForm("Create", "Persona", FormMethod.Post, new { @id = "addPersonaForm" }))
            {
                @Html.AntiForgeryToken()

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Cédula -->
                    <div>
                        <label for="cedulaPersona" class="block text-sm font-medium text-gray-700">Cédula</label>
                        @Html.TextBox("Cedula", null, new { @class = "form-input w-full", required = "required" })
                    </div>
                    <!-- Nombres -->
                    <div>
                        <label for="personaName" class="block text-sm font-medium text-gray-700">Nombres</label>
                        @Html.TextBox("Nombres", null, new { @class = "form-input w-full", required = "required" })
                    </div>
                    <!-- Apellidos -->
                    <div>
                        <label for="personaApellido" class="block text-sm font-medium text-gray-700">Apellidos</label>
                        @Html.TextBox("Apellidos", null, new { @class = "form-input w-full", required = "required" })
                    </div>
                    <!-- Fecha de nacimiento -->
                    <div>
                        <label for="personaNacimiento" class="block text-sm font-medium text-gray-700">Fecha Nacimiento</label>
                        @Html.TextBox("FechaNacimiento", null, new { @class = "form-input w-full", type = "date", required = "required" })
                    </div>
                    <!-- Rol Persona -->
                    <div>
                        <label for="personaRol" class="block text-sm font-medium text-gray-700">Rol Persona</label>
                        @Html.DropDownList("IdRol",
                                 new SelectList(ViewData["Roles"] as IEnumerable<SistemaGestionJudicial.Models.Role>, "IdRol", "Nombre"),
                                 "-- Seleccionar rol --",
                                 new { @class = "form-input w-full", required = "required" })

                    </div>
                    <!-- Género -->
                    <div>
                        <label for="personaGenero" class="block text-sm font-medium text-gray-700">Género</label>
                        @Html.DropDownList("Genero",
                                 new SelectList(new[] {
                    new SelectListItem { Text = "Masculino", Value = "M" },
                    new SelectListItem { Text = "Femenino", Value = "F" }
                    }, "Value", "Text"),
                                 "-- Seleccionar --",
                                 new { @class = "form-input w-full", required = "required" })
                    </div>
                    <!-- Dirección -->
                    <div>
                        <label for="personaDireccion" class="block text-sm font-medium text-gray-700">Dirección</label>
                        @Html.TextBox("Direccion", null, new { @class = "form-input w-full", required = "required" })
                    </div>
                    <!-- Teléfono -->
                    <div>
                        <label for="personaTelefono" class="block text-sm font-medium text-gray-700">Teléfono</label>
                        @Html.TextBox("Telefono", null, new { @class = "form-input w-full", required = "required", placeholder = "Ej: 0999999999" })
                    </div>
                    <!-- Correo Electrónico -->
                    <div>
                        <label for="personaCorreo" class="block text-sm font-medium text-gray-700">Correo</label>
                        @Html.TextBox("CorreoElectronico", null, new { @class = "form-input w-full", type = "email", required = "required", placeholder = "Ej: ejemplo@gmail.com" })
                    </div>
                </div>

                <div class="flex justify-center mt-6 align-items-center">
                    <!-- Botón Cancelar -->
                    <button type="button" class="bg-gray-500 text-white px-4 py-2 rounded-lg mr-2" onclick="closeModal('add-persona-modal')">
                        Cancelar
                    </button>
                    <!-- Botón Enviar -->
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg">Agregar Persona</button>
                </div>
            }

            <!-- Mensaje de carga -->
            <div id="loadingMessage" style="display: none; text-align: center; margin-top: 20px;">
                Cargando... Por favor espere.
            </div>
        </div>
    </div>


    <!-- Modal para editar persona -->
    <div id="edit-persona-modal" class="modal hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50">
        <div class="modal-content bg-white rounded-lg p-6 w-full max-w-3xl">
            <h3 class="text-lg text-center text-blue-600 font-bold mb-4">Editar Persona</h3>

            @using (Html.BeginForm("Edit", "Persona", FormMethod.Post, new { id = "editPersonaForm" }))
            {
                @Html.AntiForgeryToken()
                @Html.Hidden("IdPersona", "", new { id = "editIdPersona" })

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Cédula</label>
                        @Html.TextBox("Cedula", null, new { @class = "form-input w-full", required = "required", id = "editCedula" })
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Nombres</label>
                        @Html.TextBox("Nombres", null, new { @class = "form-input w-full", required = "required", id = "editNombres" })
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Apellidos</label>
                        @Html.TextBox("Apellidos", null, new { @class = "form-input w-full", required = "required", id = "editApellidos" })
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Fecha Nacimiento</label>
                        @Html.TextBox("FechaNacimiento", null, new { @class = "form-input w-full", type = "date", required = "required", id = "editFechaNacimiento" })
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Rol Persona</label>
                        @Html.DropDownList("IdRol",
                                 new SelectList(ViewData["Roles"] as IEnumerable<SistemaGestionJudicial.Models.Role>, "IdRol", "Nombre"),
                                 "-- Seleccionar rol --",
                                 new { @class = "form-input w-full", required = "required", id = "editPersonaRol" })
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Género</label>
                        @Html.DropDownList("Genero",
                                 new SelectList(new[] {
                    new SelectListItem { Text = "Masculino", Value = "M" },
                    new SelectListItem { Text = "Femenino", Value = "F" }
                    }, "Value", "Text"),
                                 "-- Seleccionar --",
                                 new { @class = "form-input w-full", required = "required", id = "editPersonaGenero" })
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Dirección</label>
                        @Html.TextBox("Direccion", null, new { @class = "form-input w-full", required = "required", id = "editPersonaDireccion" })
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Teléfono</label>
                        @Html.TextBox("Telefono", null, new { @class = "form-input w-full", required = "required", placeholder = "Ej: 0999999999", id = "editPersonaTelefono" })
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Correo</label>
                        @Html.TextBox("CorreoElectronico", null, new { @class = "form-input w-full", type = "email", required = "required", placeholder = "Ej: ejemplo@gmail.com", id = "editPersonaCorreo" })
                    </div>
                </div>

                <div class="flex justify-center mt-6 align-items-center">
                    <button type="button" class="bg-gray-500 text-white px-4 py-2 rounded-lg mr-2" onclick="closeModal('edit-persona-modal')">
                        Cancelar
                    </button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg">Guardar Cambios</button>
                </div>
            }
        </div>
    </div>



    <!-- Modal para ver detalles de la persona -->
    <div id="persona-detalle-modal" class="modal hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50">
        <div class="modal-content bg-white rounded-lg p-6 w-full max-w-3xl">
            <h3 class="text-lg text-center text-blue-600 font-bold mb-4">Detalles de la Persona</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Detalles de la persona -->
                <div>
                    <label for="detalleCedula" class="block text-sm font-medium text-gray-700">Cédula</label>
                    <p id="detalle-cedula" class="form-input w-full"></p>
                </div>
                <div>
                    <label for="detalleNombre" class="block text-sm font-medium text-gray-700">Nombre</label>
                    <p id="detalle-nombres" class="form-input w-full"></p>
                </div>
                <div>
                    <label for="detalleApellido" class="block text-sm font-medium text-gray-700">Apellido</label>
                    <p id="detalle-apellidos" class="form-input w-full"></p>
                </div>
                <div>
                    <label for="detalleFechaNacimiento" class="block text-sm font-medium text-gray-700">Fecha de Nacimiento</label>
                    <p id="detalle-fecha-nacimiento" class="form-input w-full"></p>
                </div>
                <div>
                    <label for="detalleGenero" class="block text-sm font-medium text-gray-700">Género</label>
                    <p id="detalle-genero" class="form-input w-full"></p>
                </div>
                <div>
                    <label for="detalleDireccion" class="block text-sm font-medium text-gray-700">Dirección</label>
                    <p id="detalle-direccion" class="form-input w-full"></p>
                </div>
                <div>
                    <label for="detalleTelefono" class="block text-sm font-medium text-gray-700">Teléfono</label>
                    <p id="detalle-telefono" class="form-input w-full"></p>
                </div>
                <div>
                    <label for="detalleCorreo" class="block text-sm font-medium text-gray-700">Correo</label>
                    <p id="detalle-correo" class="form-input w-full"></p>
                </div>
                <div>
                    <label for="detalleRol" class="block text-sm font-medium text-gray-700">Rol</label>
                    <p id="detalle-rol" class="form-input w-full"></p>
                </div>
            </div>

            <!-- Botón Cerrar -->
            <div class="flex justify-center mt-6 align-items-center">
                <button type="button" class="bg-gray-500 text-white px-4 py-2 rounded-lg mr-2" onclick="closeModal('persona-detalle-modal')">
                    Cerrar
                </button>
            </div>
        </div>
    </div>




    @* <!-- Modal para confirmar eliminación de persona -->
<div id="delete-confirm-modal" class="modal hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50">
    <div class="modal-content bg-white rounded-lg p-6 w-full max-w-md">
        <h3 class="text-lg text-center text-red-600 font-bold mb-4">Confirmar Eliminación</h3>

        <p id="delete-confirm-message" class="text-center text-sm text-gray-700 mb-4">
            ¿Estás seguro de eliminar a esta persona?
        </p>

        <!-- Formulario que apunta al método POST DeleteConfirmed -->
        @using (Html.BeginForm("DeleteConfirmed", "Persona", FormMethod.Post, new { id = "formEliminarPersona" }))
        {
            @Html.AntiForgeryToken()
            @Html.Hidden("id", "", new { id = "deletePersonaId" })

            <div class="flex justify-center gap-4">
                <button type="button" class="bg-gray-500 text-white px-4 py-2 rounded-lg" onclick="closeModal('delete-confirm-modal')">
                    Cancelar
                </button>
                <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded-lg">
                    Eliminar
                </button>
            </div>
        }
    </div>
</div> *@

    @* 
    -----------------------------
    -----------------------------
    ||                         ||
    ||     SCRIPTS GENERALES   ||
    ||                         ||
    -----------------------------
    -----------------------------
*@


    //EDITAR
    <script>
                function openEditModal(IdPersona, Cedula, Nombres, Apellidos, FechaNacimiento, Genero, Direccion, Telefono, CorreoElectronico, IdRol) {
            document.getElementById('editIdPersona').value = IdPersona;
            document.getElementById('editCedula').value = Cedula;
            document.getElementById('editNombres').value = Nombres;
            document.getElementById('editApellidos').value = Apellidos;
            document.getElementById('editFechaNacimiento').value = FechaNacimiento;
            document.getElementById('editPersonaRol').value = IdRol;
            document.getElementById('editPersonaGenero').value = Genero;
            document.getElementById('editPersonaDireccion').value = Direccion ?? '';
            document.getElementById('editPersonaTelefono').value = Telefono ?? '';
            document.getElementById('editPersonaCorreo').value = CorreoElectronico ?? '';

            openModal('edit-persona-modal');
        }


    </script>

    //ELIMINAR
    <script>
            function confirmDelete(IdPersona, Nombres, Apellidos) {
            document.getElementById('deletePersonaId').value = IdPersona;
            document.getElementById('delete-confirm-message').innerText =
                `¿Estás seguro de eliminar a ${Nombres} ${Apellidos}?`;
            openModal('delete-confirm-modal');
        }
    </script>

    //DETALLE
    <script>
            // Función para abrir el modal y cargar los detalles de la persona
        function verDetallePersona(IdPersona,Cedula,Nombres,Apellidos,FechaNacimiento,Genero,Direccion,Telefono,CorreoElectronico,IdRol) {
            // Rellenar el modal con los detalles de la persona
            document.getElementById('detalle-cedula').innerText = Cedula;
            document.getElementById('detalle-nombres').innerText = Nombres;
            document.getElementById('detalle-apellidos').innerText = Apellidos;
            document.getElementById('detalle-fecha-nacimiento').innerText = FechaNacimiento;
            let generoTexto = '';
        if (Genero === 'M') {
            generoTexto = 'Masculino';
        } else if (Genero === 'F') {
            generoTexto = 'Femenino';
        } else {
            generoTexto = 'No especificado';  // Si el valor no es M o F, se muestra "No especificado"
        }
        document.getElementById('detalle-genero').innerText = generoTexto;
            document.getElementById('detalle-direccion').innerText = Direccion;
            document.getElementById('detalle-telefono').innerText = Telefono;
            document.getElementById('detalle-correo').innerText = CorreoElectronico;
            document.getElementById('detalle-rol').innerText = IdRol ?? '—';  // Asumimos que 'RolNombre' es el nombre del rol

            openModal('persona-detalle-modal');  // Abrir el modal con los detalles
        }

        // Función para abrir el modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        // Función para cerrar el modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

    </script>

    <script>
            // Mostrar modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        // Ocultar modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

    </script>
